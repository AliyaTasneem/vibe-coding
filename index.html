<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnQuest - Grade 10 CBSE</title>

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        connect-src 'self' https://*.amazonaws.com https://*.amplifyapp.com;
        font-src 'self';
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
    ">

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="quiz-styles.css">
    <link rel="stylesheet" href="auth-styles.css">

    <!-- AWS Amplify SDK -->
    <script src="https://cdn.jsdelivr.net/npm/aws-amplify@5/dist/aws-amplify.min.js"></script>
</head>
<body>
    <!-- HTTPS Redirect for Production -->
    <script>
        // Force HTTPS in production (not on localhost)
        if (window.location.protocol !== 'https:' &&
            window.location.hostname !== 'localhost' &&
            window.location.hostname !== '127.0.0.1' &&
            window.location.hostname !== '') {
            window.location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        }
    </script>

    <!-- Authentication Modal -->
    <div id="auth-container" class="auth-modal">
        <div class="auth-card">
            <h2 id="auth-title">Welcome to LearnQuest üéÆ</h2>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form-container active">
                <form class="auth-form" onsubmit="handleLogin(event)">
                    <div class="auth-error" id="login-error"></div>

                    <div class="auth-input-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="auth-input"
                               placeholder="your.email@example.com" required>
                    </div>

                    <div class="auth-input-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="auth-input"
                               placeholder="Enter your password" required>
                    </div>

                    <button type="submit" class="auth-button auth-button-primary">
                        Login
                    </button>

                    <div class="auth-link">
                        <a href="#" onclick="showForgotPassword(); return false;">Forgot Password?</a>
                    </div>
                </form>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="auth-form-container">
                <form class="auth-form" onsubmit="handleSignup(event)">
                    <div class="auth-error" id="signup-error"></div>
                    <div class="auth-success" id="signup-success"></div>

                    <div class="auth-input-group">
                        <label for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" class="auth-input"
                               placeholder="Enter your name" required>
                    </div>

                    <div class="auth-input-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="auth-input"
                               placeholder="your.email@example.com" required>
                    </div>

                    <div class="auth-input-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="auth-input"
                               placeholder="Create a strong password" required
                               oninput="checkPasswordStrength(this.value)">
                        <div class="password-requirements">
                            Must be at least 8 characters with uppercase, lowercase, and numbers
                        </div>
                        <div class="password-strength">
                            <div id="password-strength-bar" class="password-strength-bar"></div>
                        </div>
                    </div>

                    <button type="submit" class="auth-button auth-button-primary">
                        Create Account
                    </button>
                </form>

                <!-- Email Verification Section -->
                <div id="verification-section" class="verification-section">
                    <h4>Verify Your Email</h4>
                    <p>Enter the verification code sent to your email:</p>
                    <div class="auth-input-group">
                        <input type="text" id="verification-code" class="auth-input"
                               placeholder="Enter 6-digit code" maxlength="6">
                    </div>
                    <button class="auth-button auth-button-primary" onclick="handleVerification()">
                        Verify Email
                    </button>
                    <div class="auth-link">
                        <a href="#" onclick="resendVerificationCode(); return false;">Resend Code</a>
                    </div>
                </div>
            </div>

            <!-- Data Migration Section (shown after login if local data exists) -->
            <div id="migrate-section" class="migrate-section" style="display: none;">
                <h4>üì¶ Local Data Found</h4>
                <p>Would you like to sync your local progress to the cloud?</p>
                <button class="auth-button auth-button-primary" onclick="handleDataMigration()">
                    Sync to Cloud
                </button>
                <button class="auth-button auth-button-secondary" onclick="skipMigration()">
                    Skip for Now
                </button>
            </div>

            <div class="auth-footer">
                <p>Your progress will be saved in the cloud and accessible from any device.</p>
            </div>
        </div>
    </div>
    <div class="header">
        <div class="header-left">
            <span class="logo">üéÆ LearnQuest</span>
            <span class="level-badge" id="userLevel">Level 1</span>
        </div>
        <div class="nav-menu">
            <a href="#" class="nav-item active" onclick="showSection('dashboard')">Dashboard</a>
            <a href="#" class="nav-item" onclick="showSection('subjects')">My Subjects</a>
            <a href="#" class="nav-item" onclick="showSection('achievements')">Achievements</a>
            <a href="#" class="nav-item" onclick="showSection('leaderboard')">Leaderboard</a>
        </div>
        <div class="header-right">
            <div class="xp-display">
                <span class="xp-icon">‚≠ê</span>
                <span id="totalXP">0 XP</span>
            </div>
            <div class="streak-display">
                <span>üî•</span>
                <span id="streakDays">0</span>
            </div>
            <div class="user-avatar" onclick="toggleProfile()">
                <span id="userInitial">S</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section active">
            <div class="welcome-card">
                <h1>Welcome back, <span id="userName">Saqib</span>! üöÄ</h1>
                <p class="motivational-quote" id="dailyQuote">Keep pushing forward! Every chapter you complete brings you closer to your goals.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">üìö</div>
                    <div class="stat-info">
                        <h3>Chapters Completed</h3>
                        <p><span id="chaptersCompleted">0</span> <span class="sub-text">/ 85</span></p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">‚è±Ô∏è</div>
                    <div class="stat-info">
                        <h3>Study Time</h3>
                        <p><span id="studyHours">0</span> <span class="sub-text">hours</span></p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">üéØ</div>
                    <div class="stat-info">
                        <h3>Daily Goal</h3>
                        <p><span id="dailyProgress">0</span><span class="sub-text">%</span></p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">üèÜ</div>
                    <div class="stat-info">
                        <h3>Achievements</h3>
                        <p><span id="achievementCount">0</span> <span class="sub-text">/ 24</span></p>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="left-column">
                    <div class="section-title">Quick Actions</div>
                    <div class="quick-actions">
                        <button class="action-btn primary" onclick="startStudySession()">
                            <span class="btn-icon">üìñ</span>
                            <span>Start Study Session</span>
                        </button>
                        <button class="action-btn secondary" onclick="takeQuiz()">
                            <span class="btn-icon">üìù</span>
                            <span>Take Quiz</span>
                        </button>
                        <button class="action-btn tertiary" onclick="reviewProgress()">
                            <span class="btn-icon">üìä</span>
                            <span>Review Progress</span>
                        </button>
                    </div>

                    <div class="section-title" style="margin-top: 30px;">Your Subjects</div>
                    <div class="subjects-compact" id="subjectsCompact"></div>
                </div>

                <div class="right-column">
                    <div class="sidebar-card">
                        <div class="section-title">Today's Goals üéØ</div>
                        <div class="goal-list" id="todayGoals"></div>
                        <button class="add-goal-btn" onclick="addGoal()">+ Add Goal</button>
                    </div>

                    <div class="sidebar-card">
                        <div class="section-title">Recent Achievements üèÜ</div>
                        <div id="recentAchievements"></div>
                    </div>

                    <div class="sidebar-card">
                        <div class="section-title">Weekly Challenge üåü</div>
                        <div class="challenge-card">
                            <h4>Complete 10 chapters this week</h4>
                            <div class="progress-bar-container">
                                <div class="progress-bar-fill challenge" id="weeklyChallenge" style="width: 0%;"></div>
                            </div>
                            <p class="challenge-reward">Reward: +500 XP + Golden Badge</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subjects Section -->
        <div id="subjects-section" class="section">
            <div class="section-title">Grade 10 CBSE Subjects</div>
            <div class="subjects-grid-detailed" id="subjectsDetailed"></div>
        </div>

        <!-- Achievements Section -->
        <div id="achievements-section" class="section">
            <div class="section-title">Your Achievements</div>
            <div class="achievements-grid" id="achievementsGrid"></div>
        </div>

        <!-- Leaderboard Section -->
        <div id="leaderboard-section" class="section">
            <div class="section-title">Leaderboard</div>
            <div class="leaderboard-info">
                <p>Compare your progress with other students (simulated data for motivation)</p>
            </div>
            <div class="leaderboard-table" id="leaderboardTable"></div>
        </div>
    </div>

    <!-- Study Session Modal -->
    <div id="studyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Start Study Session</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script src="logger.js"></script>
    <script src="amplify-config.js"></script>
    <script src="graphql-queries.js"></script>
    <script src="data-service.js"></script>
    <script src="questions.js"></script>
    <script src="app.js"></script>
    <script src="app-quiz.js"></script>
</body>
</html>
